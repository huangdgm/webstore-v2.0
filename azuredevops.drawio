<mxfile host="app.diagrams.net" modified="2021-04-28T04:39:06.900Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36 Edg/89.0.774.48" etag="5L7eOBbSMPO1XJyltbxf" version="14.6.6" type="github">
  <diagram name="Page-1" id="c7558073-3199-34d8-9f00-42111426c3f3">
    <mxGraphModel dx="2028" dy="525" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="826" pageHeight="1169" background="#ffffff" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="XLw2QElRQLzWadG3xqqA-7" value="" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-560" y="525" width="590" height="305" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-96" value="&amp;lt;COMMON_DOCKERFILE_CONTENT&amp;gt;&lt;br&gt;Dockerfile" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-480" y="620" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-98" value="Alibaba specific instructions" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-177" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-101" value="" style="shape=cross;whiteSpace=wrap;html=1;size=0;" parent="1" vertex="1">
          <mxGeometry x="-225" y="635" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-106" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=openThin;endFill=0;" parent="1" source="DJit7XBmtXHK6iYe5bfM-104" target="DJit7XBmtXHK6iYe5bfM-105" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-104" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;flipH=1;rotation=90;" parent="1" vertex="1">
          <mxGeometry x="-220" y="643" width="20" height="120" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-105" value="ali_Dockerfile" style="whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
          <mxGeometry x="-270" y="733" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-115" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=openThin;endFill=0;" parent="1" source="DJit7XBmtXHK6iYe5bfM-107" target="DJit7XBmtXHK6iYe5bfM-114" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-116" value="Push image" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="DJit7XBmtXHK6iYe5bfM-115" vertex="1" connectable="0">
          <mxGeometry x="0.2435" y="1" relative="1" as="geometry">
            <mxPoint x="-1" y="-7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-107" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCFFFF;" parent="1" vertex="1">
          <mxGeometry x="160" y="510" width="190" height="550" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-108" value="&lt;p&gt;&lt;font style=&quot;font-size: 18px&quot;&gt;Build Pipeline&lt;/font&gt;&lt;/p&gt;&lt;div&gt;Running in Microsoft Agent&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Name: jupyterhub_alicloud_image&lt;br&gt;File:&amp;nbsp;azure-pipelines-alicloud.yml" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="160" y="510" width="190" height="93" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-109" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CCFFFF;" parent="1" vertex="1">
          <mxGeometry x="423" y="510" width="190" height="280" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-110" value="&lt;p&gt;&lt;font style=&quot;font-size: 18px&quot;&gt;Release Pipeline&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&lt;font style=&quot;font-size: 12px&quot;&gt;Running in dsw-dev-deploy&lt;/font&gt;&lt;/p&gt;&lt;p&gt;Name: Jupyterhub Alicloud&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="438" y="520" width="160" height="73" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-114" value="Azure Container Registry" style="rounded=1;whiteSpace=wrap;html=1;align=left;fillColor=#FFFFCC;" parent="1" vertex="1">
          <mxGeometry x="185" y="1104" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-117" value="$(Build.SourcesDirectory)&lt;br&gt;$(Build.DefinitionName)&lt;br&gt;$(Agent.TempDirectory)&lt;br&gt;$(Build.BuildNumber)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="80" y="20" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-119" value="BuildSparkAlicloud" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6FFCC;" parent="1" vertex="1">
          <mxGeometry x="174" y="610" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-120" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6FFCC;" parent="1" vertex="1">
          <mxGeometry x="174" y="650" width="160" height="400" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-121" value="BuildDatascienceAlicloud" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="234" y="660" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-118" value="Script&lt;br&gt;Inject common docker file contents into Alicloud dockerfile" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="184" y="690" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-122" value="DownloadSecureFile@1&lt;br&gt;Name: azure_cert&lt;br&gt;azure_cert.cert" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="184" y="760" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-123" value="DownloadSecureFile@1&lt;br&gt;Name: adapt_cert&lt;br&gt;adapt_cert.pem" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="184" y="830" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-124" value="Script&lt;br&gt;&lt;br&gt;Copy cert and pem file into the &#39;image&#39; folder" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="184" y="900" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-125" value="Docker@2&lt;br&gt;&lt;br&gt;Build and push the image to the container register" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="184" y="970" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-126" value="Download the file to the agent. You can refer to the path of the downloaded file via, e.g., $(azure_cert.secureFilePath)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-90" y="777" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-127" value="" style="curved=1;endArrow=openThin;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;" parent="1" source="DJit7XBmtXHK6iYe5bfM-126" target="DJit7XBmtXHK6iYe5bfM-122" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="30" y="870" as="sourcePoint" />
            <mxPoint x="80" y="820" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-128" value="" style="curved=1;endArrow=openThin;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;" parent="1" source="DJit7XBmtXHK6iYe5bfM-126" target="DJit7XBmtXHK6iYe5bfM-123" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="50" y="790" as="sourcePoint" />
            <mxPoint x="180" y="800" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-129" value="Copy the downloaded file to the &#39;$(Build.SourcesDirectory)/image/&#39; folder on the agent machine" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-120" y="870" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="DJit7XBmtXHK6iYe5bfM-130" value="" style="curved=1;endArrow=openThin;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;" parent="1" source="DJit7XBmtXHK6iYe5bfM-129" target="DJit7XBmtXHK6iYe5bfM-124" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="20" y="1010" as="sourcePoint" />
            <mxPoint x="70" y="960" as="targetPoint" />
            <Array as="points">
              <mxPoint x="130" y="910" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="il-n5H-Y7gPzBwniJYFg-1" value="Trigger" style="triangle;whiteSpace=wrap;html=1;fillColor=#FFCCCC;" parent="1" vertex="1">
          <mxGeometry x="124" y="430" width="50" height="80" as="geometry" />
        </mxCell>
        <mxCell id="il-n5H-Y7gPzBwniJYFg-2" value="" style="endArrow=openThin;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;endFill=0;" parent="1" source="il-n5H-Y7gPzBwniJYFg-1" target="DJit7XBmtXHK6iYe5bfM-107" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="70" y="600" as="sourcePoint" />
            <mxPoint x="120" y="550" as="targetPoint" />
            <Array as="points">
              <mxPoint x="255" y="490" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="il-n5H-Y7gPzBwniJYFg-3" value="Command: the type of command to execute&lt;br&gt;Repository: name of repository within the container registry&lt;br&gt;ContainerRegistry: name of the Docker Registry Service Connection" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-160" y="940" width="240" height="70" as="geometry" />
        </mxCell>
        <mxCell id="il-n5H-Y7gPzBwniJYFg-5" value="" style="curved=1;endArrow=openThin;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;" parent="1" source="il-n5H-Y7gPzBwniJYFg-3" target="DJit7XBmtXHK6iYe5bfM-125" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="80" y="1110" as="sourcePoint" />
            <mxPoint x="130" y="1060" as="targetPoint" />
            <Array as="points">
              <mxPoint x="130" y="990" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="il-n5H-Y7gPzBwniJYFg-6" value="To reduce the code duplication, the Alicloud dockerfile should be created based on the common docker file" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-490" y="710" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="il-n5H-Y7gPzBwniJYFg-8" value="" style="curved=1;endArrow=openThin;html=1;exitX=0.875;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitPerimeter=0;endFill=0;" parent="1" source="XLw2QElRQLzWadG3xqqA-7" target="DJit7XBmtXHK6iYe5bfM-118" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-150" y="620" as="sourcePoint" />
            <mxPoint x="-100" y="570" as="targetPoint" />
            <Array as="points">
              <mxPoint x="90" y="678" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="il-n5H-Y7gPzBwniJYFg-9" value="Job" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="620" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="il-n5H-Y7gPzBwniJYFg-10" value="Another job" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="10" y="567" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="il-n5H-Y7gPzBwniJYFg-12" value="" style="curved=1;endArrow=openThin;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;endFill=0;" parent="1" source="il-n5H-Y7gPzBwniJYFg-9" target="DJit7XBmtXHK6iYe5bfM-120" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="50" y="780" as="sourcePoint" />
            <mxPoint x="100" y="730" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="il-n5H-Y7gPzBwniJYFg-13" value="" style="curved=1;endArrow=openThin;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;endFill=0;" parent="1" source="il-n5H-Y7gPzBwniJYFg-10" target="DJit7XBmtXHK6iYe5bfM-119" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-120" y="640" as="sourcePoint" />
            <mxPoint x="-70" y="590" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XLw2QElRQLzWadG3xqqA-1" value="Every new commit changes to the master branch except to the changes made to certain files/paths" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-105" y="400" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="XLw2QElRQLzWadG3xqqA-2" value="" style="curved=1;endArrow=openThin;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;" parent="1" source="XLw2QElRQLzWadG3xqqA-1" target="il-n5H-Y7gPzBwniJYFg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-90" y="580" as="sourcePoint" />
            <mxPoint x="-40" y="530" as="targetPoint" />
            <Array as="points">
              <mxPoint x="80" y="490" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XLw2QElRQLzWadG3xqqA-3" value="In this case, the goal of the build pipeline is to build two images - one for Spark, another for Data Science Workplace, and push these images to the Azure Container Registry.&lt;br&gt;&lt;br&gt;The build process happens in the build agent pool - a collection of build agent machines. You can choose to run the build on one or more build agent pool - either Azure-hosted machines or self-hosted machines.&lt;br&gt;&lt;br&gt;A build pipeline consists of one or more jobs. Each job can specify which agent pool it will be using - implies they can use different agent pools for different jobs." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-460" y="360" width="300" height="190" as="geometry" />
        </mxCell>
        <mxCell id="XLw2QElRQLzWadG3xqqA-4" value="" style="curved=1;endArrow=openThin;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;endFill=0;" parent="1" source="XLw2QElRQLzWadG3xqqA-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-30" y="610" as="sourcePoint" />
            <mxPoint x="150" y="550" as="targetPoint" />
            <Array as="points">
              <mxPoint x="30" y="500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XLw2QElRQLzWadG3xqqA-5" value="As soon as the build has been completed, the image will be pushed to the Azure Container Registry where waiting for being pulled onto the cluster worker nodes" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-110" y="1050" width="190" height="90" as="geometry" />
        </mxCell>
        <mxCell id="XLw2QElRQLzWadG3xqqA-6" value="" style="curved=1;endArrow=openThin;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;" parent="1" source="XLw2QElRQLzWadG3xqqA-5" target="DJit7XBmtXHK6iYe5bfM-114" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="130" y="1160" as="sourcePoint" />
            <mxPoint x="180" y="1110" as="targetPoint" />
            <Array as="points">
              <mxPoint x="140" y="1130" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XLw2QElRQLzWadG3xqqA-8" value="What they are used for? Why need two download tasks here?&lt;br&gt;&lt;ul&gt;&lt;li&gt;&lt;span&gt;These two secret files are used by Adapt2 package to function properly.&lt;/span&gt;&lt;/li&gt;&lt;li&gt;To enable Adapt2 to leverage these two files, firstly, these two files need to be stored inside the container&#39;s filesystem. With this concept in mind, then it is easy to understand that these two files need to be included in the image by using the &#39;ADD&#39; command inside the Dockerfile. Then, why we get the contents of these two files through the &#39;Download task&#39;? The reason is security. Since these two files contain sensitive data, it is not appropriate to store these data directly in Git, instead, to keep them secure, we can upload these two files to the &#39;Azure DevOps Library&#39; beforehand and use them throughout the whole build pipeline.&lt;/li&gt;&lt;/ul&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-450" y="830" width="250" height="340" as="geometry" />
        </mxCell>
        <mxCell id="XLw2QElRQLzWadG3xqqA-9" value="" style="curved=1;endArrow=openThin;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;" parent="1" source="XLw2QElRQLzWadG3xqqA-8" target="DJit7XBmtXHK6iYe5bfM-126" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-500" y="990" as="sourcePoint" />
            <mxPoint x="-450" y="940" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-170" y="850" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XLw2QElRQLzWadG3xqqA-10" value="What should be include in a build pipeline and what should not be?&lt;br&gt;&lt;br&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;The build pipeline is meant to &#39;build&#39; the code into artefacts that is ready to be deployed. This doesn&#39;t mean those artefacts can be deployed directly without any additional configuration.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;In this case, the build pipeline produces two docker images, and nothing else. The release pipeline connects to the deployment machine (where kubectl is installed) and execute the &#39;helm upgrade&#39;. Note the &#39;helm upgrade&#39; takes in a couple of inputs. These inputs might be not suitable for being stored in Git, and this is where the release pipeline comes into the play - to &#39;feed&#39; the &#39;helm upgrade&#39; with those inputs in a secure manner.&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-86" y="190" width="360" height="190" as="geometry" />
        </mxCell>
        <mxCell id="XLw2QElRQLzWadG3xqqA-11" value="" style="curved=1;endArrow=openThin;html=1;exitX=0.942;exitY=0.988;exitDx=0;exitDy=0;endFill=0;exitPerimeter=0;" parent="1" source="XLw2QElRQLzWadG3xqqA-10" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-60" y="340" as="sourcePoint" />
            <mxPoint x="290" y="510" as="targetPoint" />
            <Array as="points">
              <mxPoint x="280" y="400" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-1" value="Configure config.yaml" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6FFCC;" vertex="1" parent="1">
          <mxGeometry x="438" y="600" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-2" value="helm repo add" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6FFCC;" vertex="1" parent="1">
          <mxGeometry x="438" y="643" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-3" value="helm repo update" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6FFCC;" vertex="1" parent="1">
          <mxGeometry x="438" y="688" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-5" value="helm upgrade" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E6FFCC;" vertex="1" parent="1">
          <mxGeometry x="438" y="733" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-6" value="Populate the &#39;placeholders&#39; with the desired value in config.yaml.&lt;br&gt;&lt;br&gt;The config.yaml is a file which includes the values that will be used by Kubernetes to create/update objects. Helm is a templating engine which is able to populate the yaml file, e.g., a deployment yaml file, with the desired values." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="683" y="497" width="250" height="133" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-7" value="" style="endArrow=openThin;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;curved=1;endFill=0;" edge="1" parent="1" source="i_gU5cKq36gxlf2kkU8D-6" target="i_gU5cKq36gxlf2kkU8D-1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="653" y="720" as="sourcePoint" />
            <mxPoint x="703" y="670" as="targetPoint" />
            <Array as="points">
              <mxPoint x="633" y="570" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-8" value="Trigger" style="triangle;whiteSpace=wrap;html=1;fillColor=#FFCCCC;" vertex="1" parent="1">
          <mxGeometry x="423" y="420" width="50" height="80" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-9" value="" style="endArrow=openThin;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;endFill=0;" edge="1" parent="1" source="i_gU5cKq36gxlf2kkU8D-8">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="452" y="470" as="sourcePoint" />
            <mxPoint x="518" y="510" as="targetPoint" />
            <Array as="points">
              <mxPoint x="518" y="470" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-10" value="Manual trigger&lt;br&gt;&lt;br&gt;The release pipeline is designed to be triggered in a manual way. It can be triggered by creating a new release." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="366" y="292" width="170" height="85" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-11" value="" style="curved=1;endArrow=openThin;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;" edge="1" parent="1" source="i_gU5cKq36gxlf2kkU8D-10" target="i_gU5cKq36gxlf2kkU8D-8">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="303" y="457" as="sourcePoint" />
            <mxPoint x="382" y="477" as="targetPoint" />
            <Array as="points">
              <mxPoint x="373" y="460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-12" value="The release pipeline will NOT be running on the build machine, it will be running on the deployment machine (dsw-dev-deploy) instead. The deployment machine need to be pre-configured within the &#39;Deployment Group&#39; page in Azure DevOps.&lt;br&gt;&lt;br&gt;This machine is pre-configured with some prerequisites such as &lt;b&gt;Microsoft agent software, Kubectl, Helm&lt;/b&gt;, etc. The agent software is provided by Microsoft and is used for running the pipeline. The Kubectl is used for communicating with the target Kubernetes cluster (via Kubernetes API Server). The Helm is like a templating engine which can manage yaml files in batch." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="573" y="292" width="350" height="158" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-13" value="" style="curved=1;endArrow=openThin;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;endFill=0;" edge="1" parent="1" source="i_gU5cKq36gxlf2kkU8D-12" target="DJit7XBmtXHK6iYe5bfM-109">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="553" y="500" as="sourcePoint" />
            <mxPoint x="603" y="450" as="targetPoint" />
            <Array as="points">
              <mxPoint x="553" y="470" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-14" value="" style="curved=1;endArrow=openThin;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endFill=0;dashed=1;" edge="1" parent="1" source="DJit7XBmtXHK6iYe5bfM-114" target="DJit7XBmtXHK6iYe5bfM-109">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="1120" as="sourcePoint" />
            <mxPoint x="410" y="650" as="targetPoint" />
            <Array as="points">
              <mxPoint x="360" y="1100" />
              <mxPoint x="370" y="1000" />
              <mxPoint x="370" y="760" />
              <mxPoint x="410" y="650" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-15" value="Once the image has been pushed to ACR, the build process is considered completed, and the release pipeline will take hand over from here.&lt;br&gt;&lt;br&gt;Before running the release pipeline, the images SHOULD BE existing on each of the worker nodes so that the new images can be deployed. The reason why the new images should be there is because the image size is huge in our case (~19GB). By pulling the image from ACR before the actual users arrive will save the waiting time for them. The pulling of the image is done by the &#39;&lt;b&gt;continuous-image-puller&lt;/b&gt;&#39;. However, if the image size is small then it is trivial to do so." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="400" y="840" width="300" height="190" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-16" value="" style="curved=1;endArrow=openThin;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;endFill=0;" edge="1" parent="1" source="i_gU5cKq36gxlf2kkU8D-15">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="373" y="1090" as="sourcePoint" />
            <mxPoint x="380" y="880" as="targetPoint" />
            <Array as="points">
              <mxPoint x="393" y="920" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-17" value="Add repo - a repo is home to a collection of charts. Each chart is a collection of yaml files which constitute a deployment.&amp;nbsp;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="683" y="642" width="250" height="52" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-18" value="" style="endArrow=openThin;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;curved=1;endFill=0;" edge="1" parent="1" source="i_gU5cKq36gxlf2kkU8D-17" target="i_gU5cKq36gxlf2kkU8D-2">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="683" y="708.5" as="sourcePoint" />
            <mxPoint x="598" y="759.9999999999999" as="targetPoint" />
            <Array as="points">
              <mxPoint x="643" y="680" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-19" value="Update repo - so that Helm know the full list of repos which it can search charts from." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="683" y="698" width="240" height="32" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-20" value="" style="endArrow=openThin;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;curved=1;endFill=0;" edge="1" parent="1" source="i_gU5cKq36gxlf2kkU8D-19" target="i_gU5cKq36gxlf2kkU8D-3">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="678" y="723" as="sourcePoint" />
            <mxPoint x="593" y="713" as="targetPoint" />
            <Array as="points">
              <mxPoint x="638" y="735" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-21" value="Upgrade - feed the existing deployment with the updated values, if any, within the config.yaml file." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="683" y="745" width="250" height="45" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-22" value="Question:&lt;br&gt;&lt;br&gt;&lt;ul&gt;&lt;li&gt;Any downtime during a new release deployment?&lt;/li&gt;&lt;li&gt;How does the continuous-image-puller work?&lt;/li&gt;&lt;li&gt;By launching a spark notebook, is all the computing happening locally or EMR?&lt;/li&gt;&lt;li&gt;Seems the spark notebook can do everything that an regular DSW notebook can do, then why we need DSW notebook?&lt;/li&gt;&lt;/ul&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="325" y="20" width="375" height="110" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-23" value="" style="endArrow=openThin;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;curved=1;endFill=0;" edge="1" parent="1" source="i_gU5cKq36gxlf2kkU8D-21" target="i_gU5cKq36gxlf2kkU8D-5">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="668" y="785" as="sourcePoint" />
            <mxPoint x="583" y="774" as="targetPoint" />
            <Array as="points">
              <mxPoint x="633" y="779" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-25" value="K8S cluster" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="525" y="1040" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-27" value="" style="curved=1;endArrow=openThin;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;endFill=0;" edge="1" parent="1" source="DJit7XBmtXHK6iYe5bfM-114" target="i_gU5cKq36gxlf2kkU8D-25">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="380" y="1130" as="sourcePoint" />
            <mxPoint x="485" y="1159" as="targetPoint" />
            <Array as="points">
              <mxPoint x="420" y="1150" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-28" value="continuous-image-puller" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="i_gU5cKq36gxlf2kkU8D-27">
          <mxGeometry x="-0.4343" y="-2" relative="1" as="geometry">
            <mxPoint x="65" y="-23" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-29" value="" style="endArrow=openThin;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;curved=1;endFill=0;" edge="1" parent="1" source="DJit7XBmtXHK6iYe5bfM-109" target="i_gU5cKq36gxlf2kkU8D-25">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="960" y="930.75" as="sourcePoint" />
            <mxPoint x="875" y="900" as="targetPoint" />
            <Array as="points">
              <mxPoint x="705" y="800" />
              <mxPoint x="705" y="1000" />
              <mxPoint x="695" y="1070" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-30" value="By running the &#39;helm upgrade&#39; command on &#39;dsw-dev-deploy&#39; will result in the K8S cluster applying the changes accordingly.&lt;br&gt;&lt;br&gt;When a user requests a new Pod, the user will be prompted to select which image to use. This is achieved by &lt;b&gt;Kubespawner&lt;/b&gt;&amp;nbsp;which spawn the pod upon request.&amp;nbsp;The kubespawner (also known as JupyterHub Kubernetes Spawner) enables JupyterHub to spawn single-user notebook servers on a Kubernetes cluster.&lt;br&gt;&lt;br&gt;To allow user to have the options to select from, you can leverage &#39;profileList&#39; in the config.yaml file." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="730" y="840" width="300" height="190" as="geometry" />
        </mxCell>
        <mxCell id="i_gU5cKq36gxlf2kkU8D-32" value="" style="curved=1;endArrow=openThin;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;endFill=0;" edge="1" parent="1" source="i_gU5cKq36gxlf2kkU8D-30">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="800" y="1083.9999999999998" as="sourcePoint" />
            <mxPoint x="700" y="1050" as="targetPoint" />
            <Array as="points">
              <mxPoint x="770" y="1070" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
